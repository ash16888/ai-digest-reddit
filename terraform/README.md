# Reddit AI Digest - Terraform Infrastructure

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç Terraform –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Reddit AI Digest –≤ AWS.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Terraform** >= 1.5.0
2. **AWS CLI** –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. **Reddit API** –∫–ª—é—á–∏ (–ø–æ–ª—É—á–∏—Ç–µ –Ω–∞ https://www.reddit.com/prefs/apps)
4. **OpenAI API** –∫–ª—é—á (–ø–æ–ª—É—á–∏—Ç–µ –Ω–∞ https://platform.openai.com/api-keys)

### –®–∞–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

1. **–°–æ–∑–¥–∞–π—Ç–µ S3 bucket –¥–ª—è Terraform state:**

   Terraform —Ç—Ä–µ–±—É–µ—Ç S3 bucket –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è. –°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ AWS Console –∏–ª–∏ AWS CLI:
   
   - **–ò–º—è bucket**: `terraform-state-reddit-ai-digest-YOUR_ACCOUNT_ID`
   - **–í–∫–ª—é—á–∏—Ç–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–∞
   - **–†–µ–≥–∏–æ–Ω**: —Ç–æ—Ç –∂–µ, —á—Ç–æ –∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é eu-central-1)

2. **–û–±–Ω–æ–≤–∏—Ç–µ backend –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `backend.tf` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ `[account-id]` –Ω–∞ –≤–∞—à AWS account ID.

3. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:**
```bash
cp terraform.tfvars.example terraform.tfvars
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ terraform.tfvars –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
```

4. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ Terraform:**
```bash
terraform init
```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–ª–∞–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**
```bash
terraform plan
```

6. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```bash
terraform apply
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
terraform/
‚îú‚îÄ‚îÄ main.tf                    # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
‚îú‚îÄ‚îÄ variables.tf              # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ outputs.tf               # –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ versions.tf              # –í–µ—Ä—Å–∏–∏ Terraform –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ backend.tf               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è S3 backend
‚îú‚îÄ‚îÄ terraform.tfvars.example # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ modules/                 # Terraform –º–æ–¥—É–ª–∏
    ‚îú‚îÄ‚îÄ lambda/             # Lambda —Ñ—É–Ω–∫—Ü–∏–∏
    ‚îú‚îÄ‚îÄ s3/                # S3 bucket
    ‚îî‚îÄ‚îÄ api_gateway/       # API Gateway
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Lambda —Ñ—É–Ω–∫—Ü–∏–∏
- **collect**: –°–±–æ—Ä –ø–æ—Å—Ç–æ–≤ –∏–∑ Reddit (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)
- **summarize**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é OpenAI
- **web-app**: FastAPI –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
Terraform –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç deployment –ø–∞–∫–µ—Ç—ã –¥–ª—è Lambda —Ñ—É–Ω–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É—è `archive_file` data source. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞, –ø–∞–∫–µ—Ç—ã –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- CloudWatch Dashboard –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–µ—Ç—Ä–∏–∫
- CloudWatch Alarms –¥–ª—è –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
- SNS —Ç–æ–ø–∏–∫ –¥–ª—è email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–∞–º–∏

–°–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `reddit_subreddits` –≤ —Ñ–∞–π–ª–µ `terraform.tfvars`:

```hcl
reddit_subreddits = [
  "ChatGPT",
  "OpenAI", 
  "ClaudeAI",
  "Bard",
  "GeminiAI",
  "DeepSeek",
  "grok",
  "LocalLLaMA"  # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–∞–±—Ä–µ–¥–¥–∏—Ç
]
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
terraform apply -target=module.lambda
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ Lambda —Ñ—É–Ω–∫—Ü–∏–π
```bash
# Terraform –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –ø–∞–∫–µ—Ç—ã –∏ –æ–±–Ω–æ–≤–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏
terraform apply
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `cron_schedule` –≤ `terraform.tfvars`:
```hcl
# –ü—Ä–∏–º–µ—Ä—ã:
cron_schedule = "cron(0 1 * * ? *)"   # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 1:00 UTC
cron_schedule = "cron(0 */6 * * ? *)" # –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
cron_schedule = "cron(0 9 ? * MON *)" # –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00 UTC
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ Lambda
```hcl
# –í terraform.tfvars
lambda_memory_size = 1024  # –£–≤–µ–ª–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å
lambda_timeout = 600       # –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç
```

## üîç –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Terraform –≤—ã–≤–µ–¥–µ—Ç –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
terraform output useful_commands

# –ö–æ–º–∞–Ω–¥—ã –±—É–¥—É—Ç –≤–∫–ª—é—á–∞—Ç—å:
# - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Lambda —Ñ—É–Ω–∫—Ü–∏–π
# - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
# - –†–∞–±–æ—Ç—É —Å S3 bucket
# - –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∞
```

## üö® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### –í–∫–ª—é—á–µ–Ω–∏–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```hcl
# –í terraform.tfvars
enable_monitoring = true
alert_email = "your-email@example.com"
```

### CloudWatch Dashboard
URL dashboard –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è. –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ Lambda
- –û—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

## üí∞ –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

–ü—Ä–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ (1 –∑–∞–ø—É—Å–∫ –≤ –¥–µ–Ω—å):
- Lambda: ~$0.50/–º–µ—Å—è—Ü
- S3: ~$0.10/–º–µ—Å—è—Ü
- CloudWatch: ~$0.05/–º–µ—Å—è—Ü
- API Gateway: ~$0.01/–º–µ—Å—è—Ü
- **–ò—Ç–æ–≥–æ: < $1/–º–µ—Å—è—Ü**

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤:
```bash
# 1. –ü–æ–ª—É—á–∏—Ç–µ –∏–º—è S3 bucket
terraform output s3_bucket_name

# 2. –û—á–∏—Å—Ç–∏—Ç–µ bucket (–∑–∞–º–µ–Ω–∏—Ç–µ BUCKET-NAME –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–º—è)
# –í–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!
aws s3 rm s3://BUCKET-NAME --recursive

# 3. –£–¥–∞–ª–∏—Ç–µ –≤—Å—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
terraform destroy
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ sensitive –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `sensitive` –≤ Terraform
- API –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Lambda
- S3 bucket –∑–∞—â–∏—â–µ–Ω –æ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- IAM —Ä–æ–ª–∏ –∏–º–µ—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞
- State —Ñ–∞–π–ª —à–∏—Ñ—Ä—É–µ—Ç—Å—è –≤ S3

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "Error creating Lambda function"
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ deployment –ø–∞–∫–µ—Ç—ã —Å–æ–∑–¥–∞–ª–∏—Å—å:
```bash
ls terraform/files/
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã: lambda_collect.zip, lambda_summarize.zip, lambda_web.zip
```

### –û—à–∏–±–∫–∞ "AccessDenied" –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å S3
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ IAM –ø—Ä–∞–≤–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è AWS CLI.

### Lambda —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ EventBridge –ø—Ä–∞–≤–∏–ª–æ:
```bash
# –ü–æ–ª—É—á–∏—Ç–µ –∏–º—è –ø—Ä–∞–≤–∏–ª–∞
terraform output eventbridge_rule_name

# –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∑–∞–º–µ–Ω–∏—Ç–µ RULE-NAME)
aws events describe-rule --name RULE-NAME
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [AWS Lambda —Å Terraform](https://learn.hashicorp.com/tutorials/terraform/lambda-api-gateway)
- [EventBridge Cron Expressions](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-create-rule-schedule.html)